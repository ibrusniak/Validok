# Validok — валидатор данных для 1С

Представляет собой функцию `Валидация(Значение, ШаблонJson)`, выполняющую всю работу по валидации значения.

## Параметры функции

- *ШаблонJson* — Строка в нотации JSON;
- *Значение* — значение поддерживаего валидатором типа, подлежащее валидации.

## Поддерживаемые валидатором типы данных (расширяется)

- Число
- Строка
- Массив

## Возвращаемое значение

Тип — Структура, содержит два ключа.

- *Результат* — Булево, признак успешности валидации данных;
- *Ошибки* — Массив - массив строк с описанием ошибок

## Примеры

**Примечание**: все строковые значения возвращаемые функцией в описаниях ошибок и текстах исключений - локализованы (**ru/uk/en**), поэтому в примерах текстовки сообщений могут быть на разных языках.

Вход:

```json
100
```

Шаблон:

```json
{
    "Тип": "Число",
    "Обязательно": true,
    "Мин": 200,
    "Макс": 300
}
```

Результат:

```json
{
    "Результат": false,
    "Ошибки": [
        "<Скаляр>: Значення має бути більшим або дорівнювати 200"
    ]
}
```

**Скаляр** - значает что валидатору было передано значение примитивного типа. При разборе валидатором поля составного объекта - на месте **Скаляр** будет указано имя соответствующего поля объекта. При валидации массива, в результатах на месте **Скаляр** будут индексы элементов массива.

Вход:

```json
[
    200,
    0,
    -3,
    -12,
    "СтрочноеЗначение",
    true,
    3
]
```

Шаблон:

```json
{
    "Тип": "Массив",
    "Обязательно": true,
    "Мин": 5,
    "Макс": 50,
    "Шаблон": {
        "Тип": "Число",
        "Обязательно": true,
        "Мин": -5,
        "Макс": 5
    }
}
```

Результат:

```json
{
    "Результат": false,
    "Ошибки": [
        "<Масив.0>: Значення має бути меньше або дорівнювати 5",
        "<Масив.3>: Значення має бути більшим або дорівнювати -5",
        "<Масив.4>: Значення має бути типу Число, але передано значення типу Строка",
        "<Масив.5>: Значення має бути типу Число, але передано значення типу Булево"
    ]
}
```

Вход:

```json
[
    [
        1,
        2,
        3
    ],
    [
        "Строка",
        null,
        2
    ],
    []
]
```

Шаблон:

```json
{
    "Тип": "Массив",
    "Обязательно": true,
    "Мин": 3,
    "Макс": 50,
    "Шаблон": {
        "Тип": "Массив",
        "Обязательно": true,
        "Мин": 1,
        "Макс": 10,
        "Шаблон": {
            "Тип": "Число",
            "Обязательно": true
        }
    }
}
```

Результат:

```json
{
    "Результат": false,
    "Ошибки": [
        "<Масив.1.0>: Значення має бути типу Число, але передано значення типу Строка",
        "<Масив.1.1>: Значення має бути типу Число, але передано значення типу Не определено",
        "<Масив.2>: Розмір масиву повинен бути більшим або дорівнювати 1"
    ]
}
```

## Файлы

- **Validok.bsl** — модуль на встроенном языке 1С, реализующий функцию **"Валидация(Шаблон, Данные)"**;
- **Validok.epf** — внешняя обработка 1С, предназначенная для интерактивного тестирования валидатора.

---

## Принципы описания шаблонов

### Общие принципы

Шаблон валидации представляет собой строку в нотации JSON. Это объект, у которого должны присутствовать следующие поля:

- **Тип** - Строка - обязательно. Описывает тип значения, которое будет проходить валидацию по данному шаблону. Значение должно точно соответствовать названию типа платформы 1С: "Число", "Строка", "Массив", "Соответсвие" и т. д. - см. выше **Поддерживаемые валидатором типы данных**;
- **Обязательно** - Булево - обязательно. Определяет, обязательно ли присутствие значения. Для примитивного типа - проверяет не является ли значение пустым значением для типа. Для составного объекта определяет еще и наличие такого поля в объекте;
- **Мин** - Число - опционально. Для типа Число - минимальное значение, для типа Строка - минимальное число симовлов, для типа Массив - минимальное число элементов. Может отсутствовать в шаблоне, тогда соответствующая проверка не проводится;
- **Макс** - Число - опционально. Для типа Число - максимальное значение, для типа Строка - максимальное число симовлов, для типа Массив - максимальное число элементов. Может отсутствовать в шаблоне, тогда соответствующая проверка не проводится;
- **ДопустимыеЗначения** - Массив - опционально. Тип значения элементов массива должен соответствовать типу указанному в **Тип**. Если задано, то проверяется вхождение значения в указаний массив допустимых значений.

На **Обязательно** оказывают влияние **Мин**, **Макс** и **ДопустимыеЗначения**.

В общем случае, если они не заданы, то **Обязательно** проверяет значение на равенство пустому значению данного типа.

- Для чисел — `0` — пустое значение типа (в рамках системы 1С), поэтому при установленном флаге **Обязательно** значение `0` не пройдет проверку.
- То же касается `""` для типа **Строка** или пустого массива для типа **Массив**.

Но если **Мин**, **Макс** или **ДопустимыеЗначения** разрешают пустое значение для данного типа, **Обязательно** игнорируется.

### Валидация данных типа Число

```json
{
    "Тип": "Число",
    "Обязательно": false
}
```

Означает: значение должно быть типа Число, может быть пустым (0)

```json
{
    "Тип": "Число",
    "Обязательно": true,
    "Мин": -7
}
```

Означает: значение должно быть типа Число, может быть пустым (**Мин** разрешает нулевое значение)

```json
{
    "Тип": "Число",
    "Обязательно": true,
    "Мин": -7,
    "Макс": -3
}
```

```json
{
    "Тип": "Число",
    "Обязательно": true,
    "ДопустимыеЗначения": [
        0, 100, 200
    ]
}
```

Означает: значение должно быть типа Число, должно быть между -3 и -7 включительно.

### Валидация данных типа Строка

Кроме перечисленных в описании для типа Число, есть новое правило: **РегулярноеВыражение**. Как можно догадаться, валидация будет пройдена, если значение соответствует регулярному выражению. В регулярном выражении не следует использовать начало строки и конец строки ('^' и '$'). **РегулярноеВыражение** должно быть не пустой строкой. Кроме того, **Мин** не может быть меньше 0 а **Макс** не может быть меньше 1.

```json
{
    "Тип": "Строка",
    "Обязательно": true,
    "Мин": 5,
    "Макс": 50,
    "РегулярноеВыражение": ".*@.*"
}
```

```json
{
    "Тип": "Строка",
    "Обязательно": true,
    "ДопустимыеЗначения": [
        "Директор", "Грузчик", "Слесарь"
    ]
}
```
